# Continue Here

- **Created**: 2026-02-19 ~9:50 PM CT
- **Task**: Pre-implementation — Vercel setup complete, SPEC-001 implementation is next
- **Branch**: main

## What's Done
- Pulled all Mac commits (scaffold, 4 specs, EDA corrections)
- Ran `/spec-check 001` — verdict: READY WITH NOTES
- Installed Vercel CLI, linked repo, created Neon Postgres DB
- Pulled env vars (`DATABASE_URL` etc.) to `.env.local`
- Pushed Drizzle schema to Vercel Postgres
- Fixed seed script: BOM handling for Drug_Info.csv, reduced batch size to 100 for Neon HTTP limits
- Removed FK constraint on `claims.ndc` (30 unmatched NDCs, 321 rows, 0.05%)
- Added TRUNCATE with RESTART IDENTITY CASCADE for clean re-seeds
- Successfully seeded: 246,955 drug_info rows, 596,090 claims rows, entity ID 1
- Updated TODO.md

## What's Remaining
- Implement SPEC-001: API routes + shared types
  - `src/lib/api-types.ts` — all TypeScript interfaces + FLAGGED_NDCS registry
  - `src/lib/parse-filters.ts` — parseFilters() utility
  - `src/lib/build-where.ts` — buildWhereClause() with Drizzle conditions + flagged NDC exclusion
  - `src/app/api/overview/route.ts` — KPIs, monthly, formulary, states, adjudication
  - `src/app/api/claims/route.ts` — drugs table, days supply, MONY, groups, manufacturers
  - `src/app/api/anomalies/route.ts` — 4 panels (kryptonite, sept spike, nov dip, KS aug batch)
  - `src/app/api/filters/route.ts` — distinct drugs, manufacturers, groups
  - `src/app/api/entities/route.ts` — entity list
- Then SPEC-002 (FilterContext), SPEC-003 (Overview view), SPEC-004 (Explorer view)

## In-Progress State
- `.claude/settings.json` modified (hook paths for Framework Desktop — intentionally local-only)
- `scripts/seed.ts` modified (BOM fix, batch size, truncate cleanup)
- `src/db/schema.ts` modified (removed FK on claims.ndc)
- `TODO.md` modified (Vercel setup marked done)
- `package-lock.json` modified (npm install ran)
- `.env.local` exists but is gitignored
- `.vercel/` directory exists but is gitignored

## Decisions Made This Session
- **Batch size 100** for Neon HTTP — 500 hit payload/param limits (10 cols × 500 = 5,000 params)
- **Removed FK on claims.ndc** — 30 NDCs in claims don't exist in drug_info (OTC/non-drug items). Keeps all 596K rows. JOINs still work via LEFT JOIN.
- **BOM on Drug_Info.csv** — not just Claims_Export.csv. Both CSVs need BOM stripping.
- **Discussed testing**: will use Vitest for API route integration tests + unit tests on parseFilters/buildWhereClause. EDA findings serve as test oracle.
- **No Python in stack** — everything TypeScript/Node/Drizzle

## Next Action
Start SPEC-001 implementation. First file: `src/lib/api-types.ts` — copy all TypeScript interfaces from the spec (FilterParams, FLAGGED_NDCS, KpiSummary, MonthlyDataPoint, OverviewResponse, ClaimsResponse, AnomaliesResponse, FiltersResponse, EntitiesResponse). Then `src/lib/parse-filters.ts`, then `src/lib/build-where.ts`, then the 5 route files.

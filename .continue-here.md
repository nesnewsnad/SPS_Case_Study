# Continue Here

- **Created**: 2026-02-20, evening (Mac)
- **Task**: SPEC-003 verified + fixed, SPEC-005 spec still needs writing, SPEC-004 not yet implemented by Framework
- **Branch**: main (up to date with origin)

## What's Done This Session

1. **Git pull + rebase** — pulled Framework's SPEC-003 implementation (3 commits), resolved 2 `.continue-here.md` conflicts
2. **SPEC-003 verified PASS** — 16/16 ACs, 6 bugs found and fixed:
   - CRITICAL: `formatPercent` multiplied by 100 but API returns 0-100 → showed "1081.0%" instead of "10.8%" (affected every % on the page)
   - MODERATE: adjudication gauge context note said "adjudicated" instead of spec's "not adjudicated" framing
   - MINOR: KPI delta arrows used +/- instead of ↑/↓
   - MINOR: card titles ("Monthly Claims Trend" → "Monthly Claims Volume", "Claims by Formulary" → "Formulary Mix")
   - MINOR: header `font-bold` → spec's `font-semibold`
   - MINOR: hero tooltip "Sep 2021" → "September 2021" via `formatMonthFull`
3. **Fixed flagged NDC toggle** — `page.tsx` sent `includeFlaggedNdcs=true` but `parseFilters` reads `flagged=true`. Toggle was cosmetic only.
4. **Fixed dropdown reset** — added "All" option to State, Formulary, and MONY dropdowns with `__all__` sentinel value. Select components now always controlled.
5. **Browser-verified on live Vercel** — all fixes confirmed working at sps-case-study.vercel.app
6. **Verification report** saved at `docs/specs/SPEC-003-verification.md`

## What's Remaining

1. **Write formal SPEC-005** — convert design doc (`docs/plans/2026-02-20-spec-005-design.md`) into numbered ACs. All design decisions locked.
2. **Brainstorm + write SPEC-006** (AI Process page)
3. **Brainstorm + write SPEC-007** (Ask the Data chat sidebar)
4. **Verify SPEC-004** when Framework implements it (Claims Explorer)
5. **Framework needs SPEC-004 implementation prompt** — similar to what we did for SPEC-003

## Key Decisions This Session

- **`formatPercent` contract**: API owns the 0-100 convention. Frontend's `formatPercent` now expects 0-100 input (`n.toFixed(1)%`), not 0-1. This affects SPEC-004 too — Claims Explorer tooltips will use the same `formatPercent`.
- **Dropdown sentinel value**: `__all__` string as sentinel for "no selection" in Radix Select. Keeps component always in controlled mode.
- **No local dev server on Mac**: Mac doesn't have `DATABASE_URL` env var (Vercel CLI not logged in). Used live Vercel deployment for browser testing instead.

## Next Action

Write the formal SPEC-005 spec at `docs/specs/SPEC-005-anomalies-recommendations.md`. All design decisions are locked in `docs/plans/2026-02-20-spec-005-design.md`. The spec needs:

1. Problem statement (editorial storytelling page, consumes `/api/anomalies`)
2. Behavior section with the full page layout from the design doc
3. Investigation panel card anatomy (hero stat, narrative, mini charts, before/after, footer)
4. COVID context banner content
5. Follow-up questions content (all 3 tabs, exact questions from design doc)
6. Extension mock-up specs (4 panels, visual treatment, narrative content)
7. File structure (new components directory `src/components/anomalies/`)
8. Numbered ACs — target ~15-18
9. Non-goals (no filtering, no real data in extensions, no mobile)

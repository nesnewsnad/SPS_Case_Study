# Continue Here

- **Created**: 2026-02-20 ~11:30 AM CT
- **Task**: SPEC-002 — FilterContext, FilterBar & URL Sync (20 ACs)
- **Branch**: main (3 commits ahead of origin)

## What's Done This Session
- Pulled Mac's perf commit (`6552464`): `optimizePackageImports` for lucide-react/recharts, `docs/PERFORMANCE.md` with 8 Vercel React Best Practices patterns
- Removed Vercel MCP (can't OAuth over SSH)
- Read all relevant files: spec, spec-check, api-types.ts, parse-filters.ts, layout.tsx, all 4 pages, all shadcn components (Select, Command, Popover, Switch, Badge, Button)
- Loaded Vercel React Best Practices skill — identified 8 applicable patterns
- **Wrote complete implementation plan**: `docs/plans/2026-02-20-spec-002-filter-context.md`
  - 5 tasks, full code for all 3 new files + modifications to 5 existing files
  - AC coverage matrix maps all 20 ACs to tasks
  - Vercel best practices baked in (Suspense boundaries, module-scope hoisting, ternary conditionals, derived state in useMemo, init-once cache pattern)

## What's Remaining
- **Implement Task 1**: Create `src/contexts/filter-context.tsx` (FilterProvider + useFilters hook + URL sync)
- **Implement Task 2**: Create `src/hooks/use-filter-options.ts` (module-level cached /api/filters fetch)
- **Implement Task 3**: Create `src/components/filter-bar.tsx` (dropdowns, comboboxes, chips, flagged toggle)
- **Implement Task 4**: Modify layout.tsx (add FilterProvider+Suspense, remove p-6), modify all 4 pages
- **Implement Task 5**: tsc check, build check, push for Mac verification

## In-Progress State
- No code written yet — plan is complete, execution not started
- Two untracked plan files: `docs/plans/2026-02-20-spec-001-api-routes.md` (old), `docs/plans/2026-02-20-spec-002-filter-context.md` (current)
- Dev server not running
- Decided on sequential execution (not subagent-driven) — tasks are tightly coupled

## Decisions Made This Session
- **Vercel MCP**: Removed — can't authenticate over SSH, not needed (use `vercel` CLI instead)
- **Execution approach**: Sequential, not subagent-driven — tasks are tightly coupled (3→1+2, 4→3), full context already loaded, Mac verifies
- **FilterState type**: Extends `FilterParams` with required `includeFlaggedNdcs: boolean` — don't redefine (spec-check note #2)
- **URL sync**: `useSearchParams` + `useRouter` with 200ms debounce via `pendingRef` accumulation pattern. No `startTransition` needed — Next.js `router.push()` already uses transitions internally
- **FilterBar placement**: FilterProvider in layout.tsx, FilterBar per-page (spec-check note #1). Requires moving `p-6` from `<main>` to each page's content wrapper
- **Combobox**: `shouldFilter={false}` on Command — we filter client-side for match count display. Results capped at 100 items for render performance
- **Date inputs**: Native `<input type="date">` — simple, no extra dependency, HTML validation via min/max
- **Pages stay server components**: They import FilterBar (client) but don't use hooks. SPEC-003/004 may convert them to client components later

## Next Action
Open `docs/plans/2026-02-20-spec-002-filter-context.md`, execute Task 1: create `src/contexts/filter-context.tsx` with the exact code from the plan. Then `npx tsc --noEmit` to verify. Then commit. Then Task 2, 3, 4, 5 sequentially.
